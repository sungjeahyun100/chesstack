# 변형체스 보드게임

이 프로젝트는 체스의 규칙에 바둑의 착수 개념을 더한 일종의 변형체스를 만드는 것이 목표이다.

규칙:
1. 두 플레이어는 8*8의 빈 보드에서부터 시작한다.
2. 각 플레이어는 폰 8개, 퀸 1개, 킹 1개, 룩 비숍 나이트 각각 2개씩 가지고 시작한다.
3. 첫 수로 백과 흑은 반드시 킹을 착수해야 한다.
4. 폰은 각 플레이어 기준 맨 끝 랭크에 착수할 수 없다.
5. 모든 기물엔 스턴 스텍이 존재하며, 쌓인 스택만큼의 수 동안 기물을 움직일 수 없다. (ex) 만약 Q이 3스텍일 경우, 그 스텍이 쌓인 시점을 기준으로 n(쌓인 시점!),n+1,n+2,n+3동안 움직일 수 없다.
6. 착수된 기물은 기본적으로 스턴 스택 1을 가진다.
7. 프로모션은 기물 착수로 간주한다.
8. 만약 스택이 쌓여있는 기물을 잡았을 경우, 그 스택이 잡은 기물에게 이전된다.
9. 기존 체스 규칙에 따라, 자살수는 허용되지 않는다.
10. 플레이어가 잡아낸 기물은 그 플레이어의 말로서 재착수가 가능하다.
11. 모든 기물엔 이동 스텍이 존재하여, 스텍을 소모하여 한 턴에 여러 번 움직일 수 있다.
12. 이동 스텍은 스턴 스텍이 한 수을 넘겨서 1씩 사라질 때마다 1씩 늘어난다.
13. 턴을 넘기는 대신, 킹을 제외한 특정 기물의 스턴 스택을 1 늘릴 수 있다.
14. 프로모션 시엔 착수된 기물에 폰의 모든 스텍이 이전된다.
15. 폰은 착수 랭크에 따라 스턴 스택이 다르게 쌓이며, 다음과 같다.백 기준으로 랭크 1: 0스턴 스텍 ~ 랭크 7: 6스턴 스텍. 흑은 반대로 랭크 8: 0스턴 스텍 ~ 랭크 2: 6스턴 스텍이다.
16. 각 플레이어는 한 턴에 하나의 기물만 움직일 수 있으며, 프로모션을 제외하고 같은 턴에 착수와 이동을 동시에 할 수 없다.


**ps** 진행방식에 따라, 캐슬링과 앙파상, 폰 두 칸이동은 존재하지 않는다.

## 구현 상태

### ✅ 구현 완료된 규칙
1. ✅ **빈 보드 시작**: 8×8 빈 보드에서 게임 시작
2. ✅ **초기 포켓**: 각 플레이어 폰 8개, 퀸/킹 각 1개, 룩/비숍/나이트 각 2개 + 아마존 1개
3. ⚠️ **킹 착수 강제**: UI에서 강제하지 않음 (수동으로 킹부터 착수 필요)
4. ✅ **폰 착수 제한**: 맨 끝 랭크에 착수 불가
5. ✅ **스턴 시스템**: 스턴 스택만큼 기물 이동 불가
6. ✅ **기본 스턴**: 착수된 기물은 스턴 스택 1
7. ⏳ **프로모션**: 미구현
8. ✅ **스턴 이전**: 잡힌 기물의 스턴이 잡은 기물에게 이전
9. ⏳ **자살수 방지**: 미구현 (킹 체크/체크메이트 로직 없음)
10. ✅ **재착수**: 잡은 기물을 포켓에서 꺼내 재착수 가능
11. ⏳ **이동 스택**: 미구현
12. ⏳ **이동 스택 충전**: 미구현
13. ✅ **스턴 추가 액션**: 턴을 넘기며 상대 기물(킹 제외) 스턴 +1
14. ⏳ **프로모션 스택 이전**: 미구현
15. ✅ **폰 랭크별 스턴**: 백 랭크1=0 ~ 랭크7=6, 흑 랭크8=0 ~ 랭크2=6
16. ✅ **한 턴 한 액션**: 드롭/이동/스턴 중 하나만 가능

### 핵심 아키텍처
- **턴 관리**: `whiteMoveCount`와 `blackMoveCount`로 각 플레이어 수 추적
- **턴 결정**: `whiteMoveCount == blackMoveCount`이면 백 턴, 아니면 흑 턴
- **스턴 감소**: 각 플레이어가 수를 두기 **전에** 해당 플레이어의 모든 기물 스턴 -1
- **포켓 시스템**: `pocketIndex` enum으로 통합 관리 (KING, QUEEN, BISHOP, KNIGHT, ROOK, PAWN, AMAZON)
- **특수 기물**: 아마존(나이트+퀸) 완전 구현

### C++ 엔진 (`src/`)
- ✅ **보드 관리** (`bc_board`): 8×8 보드, 기물 배치, 이동, 제거
- ✅ **기물 관리** (`piece`): 스턴 스택, 색상, 타입, 위치
- ✅ **합법 이동 계산** (`legalMoveChunk`): RAY_INFINITE, RAY_FINITE, JUMP
- ✅ **포켓 시스템**: 크기 7 통합 배열 (일반 6종 + 특수 1종)
- ✅ **스턴 시스템**: 
  - `applyStunTickForColor()`: 특정 색상 기물 스턴 감소
  - 스턴 상태 확인 (`isStunned()`)
  - 스턴 추가 (`addStun()`)
- ✅ **턴별 수 카운트**: `whiteMoveCount`, `blackMoveCount`
- ✅ **액션 제한**: `performedActionThisTurn` 플래그로 중복 방지
- ✅ **커스텀 포켓 생성자**: 초기 포켓 구성 설정 가능

### Python 바인딩 (`chess_python/`)
- ✅ **pybind11 기반**: C++ 엔진과 Python 연결
- ✅ **보드 상태**: `board_state()`, `pocket()`, `turn_color()`
- ✅ **기물 액션**: `place_piece()`, `move_piece()`, `add_stun()`
- ✅ **합법 이동**: `legal_moves(file, rank)`
- ✅ **수 카운트**: `white_move_count()`, `black_move_count()`
- ✅ **커스텀 포켓**: `Board(white_pocket_dict, black_pocket_dict)` 생성자
- ✅ **특수 기물 지원**: 아마존("A" 또는 "AMAZON") 인식

### Pygame UI (`play.py`)
- ✅ **보드 렌더링**: 8×8 체스보드, 밝은/어두운 칸
- ✅ **기물 표시**: 백=대문자, 흑=소문자
- ✅ **스턴 시각화**:
  - 우상단 숫자: 스턴 스택 (0이면 숨김)
  - 우하단 `*`: 스턴 상태 (이동 불가)
- ✅ **정보 패널**:
  - 현재 턴, 백/흑 수 카운트
  - 모드 표시, 드롭 기물 선택
  - 포켓 나란히 표시 (White | Black)
- ✅ **3가지 모드**: Drop(D), Move(M), Stun(S)
- ✅ **마우스 조작**: 클릭으로 착수/이동/스턴
- ✅ **키보드 단축키**: 1-7(기물 선택), Enter(턴 넘기기), R(리셋)
- ✅ **커스텀 포켓**: 아마존 1개 포함 초기화

### 파일 구조
```
project_bc/
├── src/                    # C++ 엔진
│   ├── chess.hpp          # 기물 패턴 설정 (아마존: 나이트+퀸)
│   ├── enum.hpp           # pieceType, colorType, pocketIndex
│   ├── gameboard.hpp/cpp  # 보드 관리, 포켓 시스템
│   ├── piece.hpp/cpp      # 기물 클래스, 스턴 관리
│   ├── moves.hpp          # 이동 패턴 정의
│   └── move.cpp           # 합법 이동 계산
├── chess_python/          # Python 바인딩
│   └── chess_python.cpp   # pybind11 래퍼
├── play.py                # Pygame UI
├── test/                  # C++ 테스트
├── playground/            # 터미널 플레이
└── build/                 # 빌드 출력
```

## 사용법 (Pygame UI)

### 빌드 및 실행
```bash
cd project_bc
mkdir -p build && cd build
cmake .. -DBUILD_PYTHON_BINDINGS=ON
make -j4
cd ..
python3 play.py
```

### 키보드 컨트롤
- **D**: Drop 모드 (기물 착수)
- **M**: Move 모드 (기물 이동)
- **S**: Stun 모드 (상대 기물 스턴 추가)
- **1-7**: 드롭할 기물 선택
  - 1=P (Pawn)
  - 2=N (Knight)
  - 3=B (Bishop)
  - 4=R (Rook)
  - 5=Q (Queen)
  - 6=K (King)
  - 7=A (Amazon)
- **Enter**: 턴 넘기기 (스턴 감소만 적용)
- **R**: 게임 리셋
- **Q/Esc**: 종료

### 마우스 조작
- **Drop 모드**: 클릭한 위치에 선택한 기물 착수
- **Move 모드**: 
  1. 자신의 기물 클릭 (스턴 상태가 아니어야 함)
  2. 목적지 클릭 (합법 이동만 가능)
- **Stun 모드**: 상대 기물 클릭 시 스턴 스택 +1, 턴 종료

### 화면 정보
- **좌측: 8×8 체스보드**
  - 노란색 칸: 마지막 이동
  - 녹색 칸: 선택된 기물
  - 연두색 칸: 이동 가능한 위치
  - 기물 우상단 숫자: 스턴 스택
  - 기물 우하단 `*`: 스턴 상태 (이동 불가)
  
- **우측: 정보 패널**
  - Turn: 현재 턴 (white/black)
  - White/Black moves: 각 플레이어가 둔 수
  - Mode: 현재 모드 (drop/move/stun)
  - Drop: 선택된 드롭 기물
  - Status: 마지막 액션 결과
  - Reserves: 백/흑 포켓 (나란히 표시)
  - Controls: 조작 안내

### 게임 플레이 팁
1. **첫 수는 킹 착수 권장** (규칙 3)
2. **폰 착수 시 랭크 고려**: 낮은 랭크일수록 스턴 적음
3. **스턴 관리**: 기물을 움직이기 전 스턴이 풀릴 때까지 대기
4. **포켓 활용**: 잡은 기물을 전략적 위치에 재착수
5. **스턴 추가 액션**: 상대 핵심 기물을 묶어두기

### 미구현 기능
- ❌ 프로모션 (규칙 7, 14)
- ❌ 킹 체크/체크메이트 (규칙 9)
- ❌ 이동 스택 시스템 (규칙 11, 12)
- ❌ 첫 수 킹 강제 (규칙 3)

### 향후 개발 계획
- [ ] 프로모션 구현 (폰 → 다른 기물)
- [ ] 킹 체크/체크메이트 로직
- [ ] 이동 스택 시스템
- [ ] AI 상대 (강화학습)
- [ ] 네트워크 멀티플레이어
- [ ] 게임 기록 저장/불러오기



